#!/bin/sh

#  Script.sh
#  
#
#  Created by Jack Maloney on 4/2/14.
#

export XPKG=/opt/xpkg
export LOG=/opt/xpkg/log/xpkg.log

echo -e '# XPKG PATH SETUP \nexport PATH=/opt/xpkg/bin/:/opt/xpkg/sbin/:$PATH \n# XPKG PATH SETUP END' >> $HOME/.bash_profile

sudo mkdir -p $XPKG/log
sudo mkdir -p $XPKG/bin
sudo mkdir -p $XPKG/sbin
sudo mkdir -p $XPKG/core
sudo mkdir -p $XPKG/tmp
sudo mkdir -p $XPKG/xpkgs
sudo mkdir -p $XPKG/core/info/
cd $XPKG

echo "Downloading xpkg"
sudo curl '-#' https://codeload.github.com/jmmaloney4/xpkg/zip/master > ./master.tar.gz
sudo tar -xvf ./master.tar.gz

echo "Downloading Git"
sudo curl '-#' https://codeload.github.com/git/git/tar.gz/v1.9.1 > ./git.tar.gz
echo "Unpacking Git"
sudo tar -xvf ./git.tar.gz

cd ./git-1.9.1/

echo "Building Git, This May Take A Few Minutes"
sudo make configure
sudo mkdir -p $XPKG/core/git/1.9.1/
sudo ./configure --prefix=$XPKG/core/git/1.9.1/
sudo make all
sudo make install

cd $XPKG/core/git/1.9.1/
sudo ln ./* $XPKG/bin/

cd $XPKG

sudo $XPKG/bin/git init
sudo $XPKG/bin/git remote add origin https://github.com/jmmaloney4/xpkg.git
sudo $XPKG/bin/git pull origin master
sudo git branch --set-upstream-to=origin/master

cd $XPKG/src/xpkg

sudo xcodebuild

sudo cp $XPKG/src/xpkg/build/Release/xpkg $XPKG/core/

sudo ln -fF $XPKG/core/xpkg /usr/bin/xpkg

sudo cp $XPKG/src/xpkg/xpkg/tar.sh $XPKG/core/tar.sh
sudo chmod +x $XPKG/core/tar.sh

sudo /usr/bin/xpkg update
